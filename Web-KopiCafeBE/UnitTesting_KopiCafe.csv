Feature,Function,TestCaseID,Title,Input / Steps,ExpectedResult,BlackBoxTechnique,Partition/Boundary (EP/BVA),StatementsCovered,DecisionsCovered,Preconditions,Notes
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-001,Email null -> IllegalArgumentException,{email:null, username:"u1", password:"pass"},Throws IllegalArgumentException("Email không được để trống nha"),BVA,email=null (invalid),email null check (true),email==null,none,Trường hợp biên: email missing
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-002,Username null -> IllegalArgumentException,{email:"a@b.com", username:null, password:"pass"},Throws IllegalArgumentException("Tên đăng nhập không được để trống nha"),BVA,username=null (invalid),username null check (true),username==null,none,Trường hợp biên: username missing
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-003,Password null -> IllegalArgumentException,{email:"a@b.com", username:"u1", password:null},Throws IllegalArgumentException("Mật khẩu không được để trống"),BVA,password=null (invalid),password null check (true),password==null,none,Trường hợp biên: password missing
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-004,Existing user & email verified -> IllegalStateException,{email existing and isEmailVerified=true, username:"u1", password:"pass"},Throws IllegalStateException("Email đã được sử dùng"),EP,existing user with emailVerified=true,userOpt.isPresent && user.isEmailVerified (true),user.isEmailVerified,DB seeded with such user,Kiểm tra nhánh "user exists and verified"
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-005,Existing user & username changed but conflict -> IllegalArgumentException,{email existing and isEmailVerified=false, username changed to one already used by other user},Throws IllegalArgumentException("Tên tài khoản đã tồn tại vui lòng nhập tên khác"),EP,existing user & username conflict,branch: username conflict true,username compare branches,DB must contain another user with that username,
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-006,Existing user normal -> resend OTP,{email existing and isEmailVerified=false, username same or new unique},Saves user updates, deletes existing OTPs, creates new OTP and calls emailService.send,EP,existing user & not verified,userOpt.isPresent && !isEmailVerified and username ok,all update branches,emailService.send invoked (simulate success),Mock userRepo/otpRepo/emailService
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-007,New user but username exists -> IllegalArgumentException,{email new, username already exists},Throws IllegalArgumentException("Tên tài khoản đã tồn tại"),EP,username conflict when creating new,existingByUsername.isPresent (true),existingByUsername check,DB must contain username
Authentication,AuthServiceImpl.registerOrResend,AUTH-R-008,New user normal -> create user + OTP,{email new, username unique, password provided},Saves new user, creates OTP, calls emailService.send,BVA,normal flow (valid inputs),save user + createAndSendOtp branches,create path,Mock repos and assert save called
Authentication,AuthServiceImpl.createAndSendOtp,AUTH-O-009,emailService throws -> swallow exception and continue,{valid user},No exception thrown out; warn logged,WhiteBox,trigger emailService.send throwing,try/catch branch catch path,OTP saved then emailService.send throws,Mock emailService to throw; assert no exception bubble
Authentication,AuthServiceImpl.verifyOtp,AUTH-V-001,user not found -> IllegalArgumentException,{email not in DB, plainOtp:"123456"},Throws IllegalArgumentException("Không tìm thấy user"),EP,missing user list,userRepo.findByEmailIgnoreCase empty,user not found branch,none
Authentication,AuthServiceImpl.verifyOtp,AUTH-V-002,user already verified -> return early,{email exists with isEmailVerified=true, any otp},Method returns without exception and does not delete otps,WhiteBox,user.isEmailVerified true early return path,early return branch,userRepo returns verified user,Ensure no exception
Authentication,AuthServiceImpl.verifyOtp,AUTH-V-003,OTP invalid or expired -> IllegalArgumentException,{email exists not verified, otp list contains expired or mismatched hashes},Throws IllegalArgumentException("OTP sai hoặc đã hết hạn"),EP/BVA,expired or non-matching OTPs,stream filter produces ok=false,ok==false branch,mock otpRepo with expired or non-matching hashed OTPs
Authentication,AuthServiceImpl.verifyOtp,AUTH-V-004,OTP valid -> verify and delete,{email exists not verified, otp list contains valid hashed otp matching plain},Sets user.emailVerified=true, status ACTIVE, saves user and deletes OTPs,WhiteBox,ok==true branch and subsequent save+delete,Mock bCrypt.matches to return true for one OTP
Authentication,AuthServiceImpl.markVerifiedByGoogle,AUTH-G-001,user present->{email exists},Sets emailVerified true, maybe set status ACTIVE and deletes otps,WhiteBox,optional present branch,repo.findByEmailIgnoreCase present,path present
Authentication,AuthServiceImpl.markVerifiedByGoogle,AUTH-G-002,user absent->{email not found},No exception,do nothing,WhiteBox,optional empty branch
Order,OrderServiceImpl.validateProducts,ORD-VP-001,Empty products -> BadRequest,{products: []},Return 400 with message "No products",BVA,empty list branch,products.isEmpty branch,
Order,OrderServiceImpl.validateProducts,ORD-VP-002,Product not found -> Insufficient list,{products: [{product_id:99, qty:1}]},Return 400; errors include product_id and reason not_found,EP,productRepo.findById returns empty,branch null product handling
Order,OrderServiceImpl.validateProducts,ORD-VP-003,Insufficient stock -> Insufficient list,{products: [{product_id:1, qty:5}] product.stockQty less than requested},Return 400 with available quantity in errors,EP,productRepo returns product with low stock,stock check branch
Order,OrderServiceImpl.validateProducts,ORD-VP-004,All products sufficient -> OK,{products valid with enough stock},Return 200 {message: "OK"},EP,happy path branch
Order,OrderServiceImpl.changeStatus,ORD-CS-001,Invalid status -> BadRequest,{id:1, payload: {status: "UNKNOWN"}},Return 400 with message "Invalid status",EP,invalid status check (all comparisons fail),invalid status branch
Order,OrderServiceImpl.changeStatus,ORD-CS-002,COMPLETED but product stock insufficient -> BadRequest,{order with details where product.stockQty < qty},Return 400 with message about insufficient stock,EP,COMPLETED branch with validation failing,stock validation branch
Order,OrderServiceImpl.changeStatus,ORD-CS-003,COMPLETED success -> deduct stock, update payments and notify,{order with details where product.stockQty >= qty, previousStatus != COMPLETED},Returns 200 OK, productRepository.save called for each product, payment.status set to PAID, notificationService called (mock to succeed),WhiteBox,COMPLETED deduction loop + payment update + notification try/catch success branches
Order,OrderServiceImpl.getTransactionDetail,ORD-GT-001,Forbidden for non-owner non-staff,{order.ownerId != current.userId and current.role null or not staff},Return 403 Forbidden,EP,permission checks isOwner/isStaff both false,forbidden branch
Order,OrderServiceImpl.getTransactionDetail,ORD-GT-002,Owner access allowed,{current is owner},Return 200 with data detail,EP,isOwner true branch
Order,OrderServiceImpl.getTransactionDetail,ORD-GT-003,Staff access allowed,{current role ADMIN or STAFF},Return 200 with data detail,EP,isStaff true branch
Order,OrderServiceImpl.normalizeCity,ORD-NC-001,Normalization null->{null},Input null,Return null,WhiteBox,null input branch
Order,OrderServiceImpl.normalizeCity,ORD-NC-002,Normalization Vietnamese accented->{lower ascii},Input: "Đà Nẵng"/"  Đà Nẵng " ,Return "da nang",BVA,accent removal and trim branch
